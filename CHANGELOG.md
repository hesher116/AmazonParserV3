# Changelog

Всі важливі зміни в проекті будуть документовані в цьому файлі.

Формат заснований на [Keep a Changelog](https://keepachangelog.com/uk/1.0.0/),
і цей проект дотримується [Semantic Versioning](https://semver.org/lang/uk/).

## [Unreleased]

### Додано

- **Скрипт для тестування селекторів A+**: `test_aplus_selectors.py`
  - Дозволяє тестувати різні селектори на множині товарів
  - Аналізує результати і рекомендує найкращі селектори
  - Допомагає оптимізувати швидкість парсингу A+ контенту

### Змінено

#### Оптимізація навігації (`core/browser_pool.py`)
- **Page Load Strategy**: Встановлено `page_load_strategy = 'none'` для швидшої навігації
  - `driver.get(url)` більше не чекає повного завантаження сторінки
  - Можна починати взаємодію одразу після ініціації навігації
- **Очікування галереї**: Замість очікування всієї сторінки, чекаємо тільки на елементи галереї:
  - `#landingImage` - головне зображення
  - `#imgTagWrapperId img` - обгортка зображення
  - `#altImages img` - мініатюри галереї
- **Перевірка валідності зображень**: Перевіряємо наявність `src`, `data-old-hires` або `data-src`
- **Оптимізовані таймаути**:
  - `set_page_load_timeout(30)` - fallback timeout
  - `implicitly_wait(2)` - зменшено з 5 до 2 секунд
- **Результат**: Навігація тепер займає 3-6 секунд замість 15-30+ секунд

#### Парсинг зображень (`agents/image_parser.py`)
- **Детальні логи**: Додано детальні логи для кожного кроку парсингу:
  - `[Thumbnail X/Y]` - прогрес обробки thumbnails з таймінгами
  - `[Download X/Y]` - прогрес завантаження зображень
  - `[A+ category]` - деталі парсингу A+ контенту
- **Оптимізація затримок**: 
  - Затримка для thumbnails: 0.2-0.4 сек (безпечніше, ніж 0.05-0.15)
  - WebDriverWait для очікування завантаження зображень замість фіксованих затримок
- **A+ Content Scanning**: 
  - Детальні логи про які селектори перевіряються
  - Ранній вихід якщо не знайдено після перших 3 селекторів
  - Покращена логіка пошуку секцій

#### Генерація DOCX (`core/docx_generator.py`)
- **Порядок зображень**: Виправлено сортування - тепер зображення в правильному порядку (1, 2, 3, ..., 10, 11)
- **Додавання URL**: URL продукту тепер відображається одразу після назви
- **Обробка помилок**: 
  - Додано конвертацію через PIL для проблемних форматів (RGBA/P → RGB)
  - Використання абсолютних шляхів
  - Детальні повідомлення про помилки з типом помилки та інформацією про файл
- **Структура документа**: Зображення додаються по черзі від першого до останнього

#### Утиліти (`utils/file_utils.py`)
- **Логування**: Змінено `logger.info` на `logger.debug` для зменшення дублювання логів

#### Веб-інтерфейс (`web/templates/index.html`)
- Незначні зміни в UI

### Виправлено

- **Помилка з WebDriverWait**: Видалено дубльований імпорт `WebDriverWait` всередині функції
- **Дублюючі логи**: Прибрано дублювання логів про збереження зображень
- **Помилки додавання зображень в DOCX**: Додано конвертацію через PIL для проблемних форматів
- **Порядок зображень в DOCX**: Виправлено сортування для правильного порядку (1, 2, 3, а не 1, 10, 11, 2, 3)

### Оптимізовано

- **Швидкість навігації**: Зменшено час навігації з 15-30+ секунд до 3-6 секунд
- **Швидкість парсингу thumbnails**: Оптимізовано затримки та використання WebDriverWait
- **A+ Content Scanning**: Ранній вихід якщо секції не знайдені, детальні логи для діагностики

## [1.0.0] - 2025-01-XX

### Додано

- Початкова версія Multi-Agent Amazon Parser
- Flask веб-інтерфейс
- 6 агентів парсингу:
  - Image Parser Agent
  - Text Parser Agent
  - Customer Reviews Agent
  - Q&A Parser Agent
  - Variant Detector Agent
  - Validator Agent
- SQLite база даних для історії задач
- Генерація DOCX документів
- Anti-detection заходи (undetected-chromedriver)
- MD5 дедуплікація зображень
- Структурована файлова система для результатів

